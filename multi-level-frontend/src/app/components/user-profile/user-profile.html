<div class="profile-container">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-gradient-primary text-white py-3">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <button class="btn btn-light btn-sm me-3" (click)="goBack()">
                <i class="bi bi-arrow-left"></i>
              </button>
              <i class="bi bi-person-circle fs-1 me-3"></i>
              <div>
                <h2 class="mb-0 fw-bold">User Profile</h2>
                <p class="mb-0 opacity-75">
                  {{ isOwnProfile ? 'Manage your account information' : 'View user details' }}
                </p>
              </div>
            </div>
            <div *ngIf="isOwnProfile" class="d-flex gap-2">
              <button 
                *ngIf="!isEditing" 
                class="btn btn-light" 
                (click)="toggleEdit()">
                <i class="bi bi-pencil-square me-2"></i>
                Edit Profile
              </button>
              <button 
                *ngIf="isEditing" 
                class="btn btn-success" 
                (click)="saveProfile()"
                [disabled]="isSaving">
                <span *ngIf="!isSaving">
                  <i class="bi bi-check-circle me-2"></i>
                  Save Changes
                </span>
                <span *ngIf="isSaving">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Saving...
                </span>
              </button>
              <button 
                *ngIf="isEditing" 
                class="btn btn-outline-light" 
                (click)="toggleEdit()">
                <i class="bi bi-x-circle me-2"></i>
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Content -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <h5 class="mt-4 text-muted">Loading profile...</h5>
  </div>

  <div *ngIf="!isLoading && user" class="row">
    <!-- Left Column - Profile Card -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center p-4">
          <!-- Profile Avatar -->
          <div class="profile-avatar mx-auto mb-4" [ngClass]="'bg-' + getAvatarColor() + '-subtle'">
            <span class="avatar-text">{{ getInitials() }}</span>
            <div *ngIf="isOwnProfile" class="avatar-upload">
              <label for="avatarUpload" class="avatar-upload-label">
                <i class="bi bi-camera"></i>
              </label>
              <input type="file" id="avatarUpload" class="d-none" accept="image/*">
            </div>
          </div>
          
          <!-- User Name & Role -->
          <h3 class="fw-bold mb-1">{{ user.username }}</h3>
          <div class="d-flex justify-content-center gap-2 mb-3">
            <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
              {{ user.role | titlecase }}
            </span>
            <span class="badge" [ngClass]="getStatusBadgeClass(user.isActive)">
              {{ user.isActive ? 'Active' : 'Inactive' }}
            </span>
            <span class="badge bg-primary">
              Level {{ user.level }}
            </span>
          </div>
          
          <!-- User Email -->
          <div class="d-flex align-items-center justify-content-center text-muted mb-4">
            <i class="bi bi-envelope-fill me-2"></i>
            {{ user.email }}
          </div>
          
          <!-- Quick Stats -->
          <div class="row g-2 mb-4">
            <div class="col-6">
              <div class="stat-card bg-light p-3 rounded-3">
                <i class="bi bi-cash-stack fs-4 text-success mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ formatCurrency(user.balance) }}</h5>
                <small class="text-muted">Balance</small>
              </div>
            </div>
            <div class="col-6">
              <div class="stat-card bg-light p-3 rounded-3">
                <i class="bi bi-people-fill fs-4 text-primary mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ user.downlineCount }}</h5>
                <small class="text-muted">Downline</small>
              </div>
            </div>
          </div>
          
          <!-- Membership Info -->
          <div class="membership-info bg-light p-3 rounded-3 text-start">
            <h6 class="fw-semibold mb-3">
              <i class="bi bi-calendar-check me-2"></i>
              Membership
            </h6>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Member since:</span>
              <span class="fw-semibold">{{ memberSince }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Account age:</span>
              <span class="fw-semibold">{{ accountAge }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="text-muted">Last login:</span>
              <span class="fw-semibold">{{ formatDate(user.lastLogin) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Tabs Content -->
    <div class="col-lg-8">
      <!-- Profile Navigation Tabs -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-0">
          <ul class="nav nav-tabs nav-fill" role="tablist">
            <li class="nav-item" role="presentation">
              <button 
                class="nav-link" 
                [class.active]="activeTab === 'profile'"
                (click)="setActiveTab('profile')">
                <i class="bi bi-person-badge me-2"></i>
                Profile
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button 
                class="nav-link" 
                [class.active]="activeTab === 'security'"
                (click)="setActiveTab('security')">
                <i class="bi bi-shield-lock me-2"></i>
                Security
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button 
                class="nav-link" 
                [class.active]="activeTab === 'activity'"
                (click)="setActiveTab('activity')">
                <i class="bi bi-clock-history me-2"></i>
                Activity
              </button>
            </li>
            <li *ngIf="isOwnProfile" class="nav-item" role="presentation">
              <button 
                class="nav-link" 
                [class.active]="activeTab === 'settings'"
                (click)="setActiveTab('settings')">
                <i class="bi bi-gear me-2"></i>
                Settings
              </button>
            </li>
          </ul>
        </div>
      </div>

      <!-- Profile Tab -->
      <div *ngIf="activeTab === 'profile'" class="card shadow-sm border-0">
        <div class="card-body p-4">
          <h5 class="fw-semibold mb-4">
            <i class="bi bi-info-circle me-2 text-primary"></i>
            Personal Information
          </h5>
          
          <form [formGroup]="profileForm">
            <div class="row g-4">
              <!-- Username -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-person me-1"></i>
                  Username
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="username"
                  [readonly]="true"
                  [class.is-invalid]="profileForm.get('username')?.invalid && profileForm.get('username')?.touched">
                <div *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" 
                     class="invalid-feedback">
                  {{ getErrorMessage(profileForm, 'username') }}
                </div>
              </div>
              
              <!-- Email -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-envelope me-1"></i>
                  Email Address
                  <span class="text-danger">*</span>
                </label>
                <input 
                  type="email" 
                  class="form-control" 
                  formControlName="email"
                  [class.is-invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
                <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" 
                     class="invalid-feedback">
                  {{ getErrorMessage(profileForm, 'email') }}
                </div>
              </div>
              
              <!-- First Name -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-person-circle me-1"></i>
                  First Name
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="firstName"
                  placeholder="Enter your first name">
              </div>
              
              <!-- Last Name -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-person-circle me-1"></i>
                  Last Name
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="lastName"
                  placeholder="Enter your last name">
              </div>
              
              <!-- Phone -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-telephone me-1"></i>
                  Phone Number
                </label>
                <input 
                  type="tel" 
                  class="form-control" 
                  formControlName="phone"
                  placeholder="Enter your phone number">
              </div>
              
              <!-- Address -->
              <div class="col-12">
                <label class="form-label fw-semibold">
                  <i class="bi bi-house me-1"></i>
                  Address
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="address"
                  placeholder="Street address">
              </div>
              
              <!-- City -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">City</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="city"
                  placeholder="City">
              </div>
              
              <!-- Country -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">Country</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="country"
                  placeholder="Country">
              </div>
              
              <!-- Postal Code -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">Postal Code</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="postalCode"
                  placeholder="Postal code">
              </div>
              
              <!-- Bio -->
              <div class="col-12">
                <label class="form-label fw-semibold">
                  <i class="bi bi-chat-text me-1"></i>
                  Bio
                </label>
                <textarea 
                  class="form-control" 
                  formControlName="bio"
                  rows="3"
                  placeholder="Tell us about yourself"></textarea>
                <div class="text-end mt-1">
                  <small class="text-muted">
                    {{ profileForm.get('bio')?.value?.length || 0 }}/500
                  </small>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Security Tab -->
      <div *ngIf="activeTab === 'security'" class="card shadow-sm border-0">
        <div class="card-body p-4">
          <h5 class="fw-semibold mb-4">
            <i class="bi bi-shield-lock me-2 text-primary"></i>
            Security Settings
          </h5>
          
          <!-- Password Section -->
          <div class="security-section mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="fw-semibold mb-0">Password</h6>
              <button 
                *ngIf="!showChangePassword" 
                class="btn btn-outline-primary btn-sm"
                (click)="showChangePassword = true">
                <i class="bi bi-pencil me-2"></i>
                Change Password
              </button>
            </div>
            
            <div *ngIf="!showChangePassword" class="bg-light p-3 rounded-3">
              <div class="d-flex align-items-center">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <span>Password last changed: Not available</span>
              </div>
            </div>
            
            <!-- Change Password Form -->
            <div *ngIf="showChangePassword" class="password-change-form">
              <form [formGroup]="passwordForm">
                <div class="row g-3">
                  <!-- Current Password -->
                  <div class="col-12">
                    <label class="form-label fw-semibold">
                      <i class="bi bi-key me-1"></i>
                      Current Password
                    </label>
                    <div class="input-group">
                      <input 
                        [type]="showCurrentPassword ? 'text' : 'password'"
                        class="form-control" 
                        formControlName="currentPassword"
                        placeholder="Enter current password">
                      <button 
                        class="btn btn-outline-secondary" 
                        type="button"
                        (click)="toggleCurrentPasswordVisibility()">
                        <i class="bi" [class.bi-eye]="!showCurrentPassword" [class.bi-eye-slash]="showCurrentPassword"></i>
                      </button>
                    </div>
                  </div>
                  
                  <!-- New Password -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">
                      <i class="bi bi-key-fill me-1"></i>
                      New Password
                    </label>
                    <div class="input-group">
                      <input 
                        [type]="showNewPassword ? 'text' : 'password'"
                        class="form-control" 
                        formControlName="newPassword"
                        placeholder="Enter new password"
                        [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                      <button 
                        class="btn btn-outline-secondary" 
                        type="button"
                        (click)="toggleNewPasswordVisibility()">
                        <i class="bi" [class.bi-eye]="!showNewPassword" [class.bi-eye-slash]="showNewPassword"></i>
                      </button>
                    </div>
                    
                    <!-- Password Strength -->
                    <div *ngIf="passwordForm.get('newPassword')?.value" class="mt-2">
                      <div class="d-flex justify-content-between mb-1">
                        <span class="small">Password Strength:</span>
                        <span class="small fw-bold" [ngClass]="{
                          'text-danger': passwordStrength.score <= 2,
                          'text-warning': passwordStrength.score === 3,
                          'text-info': passwordStrength.score === 4,
                          'text-success': passwordStrength.score === 5
                        }">
                          {{ getPasswordStrengthLabel() }}
                        </span>
                      </div>
                      <div class="progress" style="height: 6px;">
                        <div 
                          class="progress-bar" 
                          [ngClass]="getPasswordStrengthColor()"
                          [style.width.%]="(passwordStrength.score / 5) * 100">
                        </div>
                      </div>
                      
                      <div class="password-requirements mt-2">
                        <div class="row g-1 small">
                          <div class="col-6">
                            <span [class.text-success]="passwordStrength.hasLength" [class.text-danger]="!passwordStrength.hasLength">
                              <i class="bi" [class.bi-check-circle-fill]="passwordStrength.hasLength" [class.bi-x-circle-fill]="!passwordStrength.hasLength"></i>
                              8+ characters
                            </span>
                          </div>
                          <div class="col-6">
                            <span [class.text-success]="passwordStrength.hasUpperCase" [class.text-danger]="!passwordStrength.hasUpperCase">
                              <i class="bi" [class.bi-check-circle-fill]="passwordStrength.hasUpperCase" [class.bi-x-circle-fill]="!passwordStrength.hasUpperCase"></i>
                              Uppercase
                            </span>
                          </div>
                          <div class="col-6">
                            <span [class.text-success]="passwordStrength.hasLowerCase" [class.text-danger]="!passwordStrength.hasLowerCase">
                              <i class="bi" [class.bi-check-circle-fill]="passwordStrength.hasLowerCase" [class.bi-x-circle-fill]="!passwordStrength.hasLowerCase"></i>
                              Lowercase
                            </span>
                          </div>
                          <div class="col-6">
                            <span [class.text-success]="passwordStrength.hasNumber" [class.text-danger]="!passwordStrength.hasNumber">
                              <i class="bi" [class.bi-check-circle-fill]="passwordStrength.hasNumber" [class.bi-x-circle-fill]="!passwordStrength.hasNumber"></i>
                              Number
                            </span>
                          </div>
                          <div class="col-6">
                            <span [class.text-success]="passwordStrength.hasSpecialChar" [class.text-danger]="!passwordStrength.hasSpecialChar">
                              <i class="bi" [class.bi-check-circle-fill]="passwordStrength.hasSpecialChar" [class.bi-x-circle-fill]="!passwordStrength.hasSpecialChar"></i>
                              Special char
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Confirm Password -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">
                      <i class="bi bi-shield-check me-1"></i>
                      Confirm Password
                    </label>
                    <div class="input-group">
                      <input 
                        [type]="showConfirmPassword ? 'text' : 'password'"
                        class="form-control" 
                        formControlName="confirmPassword"
                        placeholder="Confirm new password"
                        [class.is-invalid]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched || passwordForm.errors?.['passwordMismatch']">
                      <button 
                        class="btn btn-outline-secondary" 
                        type="button"
                        (click)="toggleConfirmPasswordVisibility()">
                        <i class="bi" [class.bi-eye]="!showConfirmPassword" [class.bi-eye-slash]="showConfirmPassword"></i>
                      </button>
                    </div>
                    <div *ngIf="passwordForm.get('confirmPassword')?.touched">
                      <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']" 
                           class="invalid-feedback d-block">
                        Please confirm your password
                      </div>
                      <div *ngIf="passwordForm.errors?.['passwordMismatch']" 
                           class="invalid-feedback d-block">
                        Passwords do not match
                      </div>
                    </div>
                  </div>
                  
                  <!-- Form Actions -->
                  <div class="col-12">
                    <div class="d-flex gap-2 justify-content-end">
                      <button 
                        type="button" 
                        class="btn btn-outline-secondary"
                        (click)="showChangePassword = false; passwordForm.reset()">
                        Cancel
                      </button>
                      <button 
                        type="button" 
                        class="btn btn-primary"
                        (click)="changePassword()"
                        [disabled]="passwordForm.invalid || isSaving">
                        <span *ngIf="!isSaving">
                          <i class="bi bi-check-circle me-2"></i>
                          Update Password
                        </span>
                        <span *ngIf="isSaving">
                          <span class="spinner-border spinner-border-sm me-2"></span>
                          Updating...
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          
          <!-- Two-Factor Authentication -->
          <div class="security-section mb-4" *ngIf="isOwnProfile">
            <h6 class="fw-semibold mb-3">Two-Factor Authentication</h6>
            <div class="bg-light p-3 rounded-3">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                  <i class="bi bi-shield-check fs-4 text-primary me-3"></i>
                  <div>
                    <span class="fw-semibold d-block">Secure your account with 2FA</span>
                    <small class="text-muted">Add an extra layer of security to your account</small>
                  </div>
                </div>
                <button class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-plus-circle me-2"></i>
                  Enable
                </button>
              </div>
            </div>
          </div>
          
          <!-- Session Management -->
          <div class="security-section" *ngIf="isOwnProfile">
            <h6 class="fw-semibold mb-3">Active Sessions</h6>
            <div class="bg-light p-3 rounded-3">
              <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                  <i class="bi bi-laptop fs-4 text-info me-3"></i>
                  <div>
                    <span class="fw-semibold d-block">Current Session</span>
                    <small class="text-muted">Chrome on Windows • Last active now</small>
                  </div>
                </div>
                <span class="badge bg-success">Active</span>
              </div>
              <button class="btn btn-outline-danger btn-sm w-100">
                <i class="bi bi-x-circle me-2"></i>
                Sign Out All Devices
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Tab -->
      <div *ngIf="activeTab === 'activity'" class="card shadow-sm border-0">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="fw-semibold mb-0">
              <i class="bi bi-clock-history me-2 text-primary"></i>
              Recent Activity
            </h5>
            <a routerLink="/statement" class="btn btn-outline-primary btn-sm">
              View All Transactions
            </a>
          </div>
          
          <!-- Statistics Cards -->
          <div class="row g-3 mb-4">
            <div class="col-md-3 col-6">
              <div class="stat-card-small bg-light p-3 rounded-3 text-center">
                <span class="text-muted d-block small">Transactions</span>
                <span class="fw-bold fs-4">{{ totalTransactions }}</span>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="stat-card-small bg-light p-3 rounded-3 text-center">
                <span class="text-muted d-block small">Credits</span>
                <span class="fw-bold fs-4 text-success">{{ formatCurrency(totalCredits) }}</span>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="stat-card-small bg-light p-3 rounded-3 text-center">
                <span class="text-muted d-block small">Debits</span>
                <span class="fw-bold fs-4 text-danger">{{ formatCurrency(totalDebits) }}</span>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="stat-card-small bg-light p-3 rounded-3 text-center">
                <span class="text-muted d-block small">Monthly</span>
                <span class="fw-bold fs-4" [ngClass]="{'text-success': monthlyGrowth >= 0, 'text-danger': monthlyGrowth < 0}">
                  {{ monthlyGrowth > 0 ? '+' : '' }}{{ monthlyGrowth | number:'1.1-1' }}%
                </span>
              </div>
            </div>
          </div>
          
          <!-- Recent Transactions List -->
          <h6 class="fw-semibold mb-3">Recent Transactions</h6>
          
          <div *ngIf="recentTransactions.length === 0" class="text-center py-4">
            <i class="bi bi-arrow-left-right display-6 text-muted mb-3"></i>
            <p class="text-muted mb-0">No recent transactions</p>
          </div>
          
          <div *ngIf="recentTransactions.length > 0" class="transaction-list">
            <div *ngFor="let transaction of recentTransactions" 
                 class="transaction-item d-flex align-items-center justify-content-between p-3 mb-2 bg-light rounded-3">
              <div class="d-flex align-items-center">
                <div class="transaction-icon rounded-circle p-2 me-3" 
                     [ngClass]="'bg-' + getTransactionClass(transaction.type).replace('text-', '') + '-subtle'">
                  <i class="bi" [class]="getTransactionIcon(transaction.type)" 
                     [ngClass]="getTransactionClass(transaction.type)"></i>
                </div>
                <div>
                  <span class="fw-semibold d-block">{{ transaction.type | titlecase }}</span>
                  <small class="text-muted">
                    {{ getCounterparty(transaction) }} • {{ formatDate(transaction.createdAt) }}
                  </small>
                </div>
              </div>
              <div class="text-end">
                <span class="fw-bold d-block" [ngClass]="getTransactionClass(transaction.type)">
                  {{ transaction.type === 'credit' || transaction.type === 'recharge' || transaction.type === 'commission' ? '+' : '-' }}
                  {{ transaction.amount | currency:'USD':'symbol':'1.2-2' }}
                </span>
                <small class="text-muted">
                  Balance: {{ transaction.balanceAfter | currency:'USD':'symbol':'1.0-0' }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab === 'settings' && isOwnProfile" class="card shadow-sm border-0">
        <div class="card-body p-4">
          <h5 class="fw-semibold mb-4">
            <i class="bi bi-gear me-2 text-primary"></i>
            Account Settings
          </h5>
          
          <form [formGroup]="settingsForm">
            <!-- Notification Settings -->
            <div class="settings-section mb-4">
              <h6 class="fw-semibold mb-3">Notification Preferences</h6>
              <div class="bg-light p-3 rounded-3">
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" formControlName="emailNotifications">
                  <label class="form-check-label fw-semibold">
                    Email Notifications
                  </label>
                  <div class="small text-muted">Receive important account updates via email</div>
                </div>
                
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" formControlName="transactionAlerts">
                  <label class="form-check-label fw-semibold">
                    Transaction Alerts
                  </label>
                  <div class="small text-muted">Get notified for every transaction</div>
                </div>
                
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" formControlName="marketingEmails">
                  <label class="form-check-label fw-semibold">
                    Marketing Emails
                  </label>
                  <div class="small text-muted">Receive promotional offers and updates</div>
                </div>
              </div>
            </div>
            
            <!-- Privacy Settings -->
            <div class="settings-section mb-4">
              <h6 class="fw-semibold mb-3">Privacy & Security</h6>
              <div class="bg-light p-3 rounded-3">
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" formControlName="twoFactorAuth">
                  <label class="form-check-label fw-semibold">
                    Two-Factor Authentication
                  </label>
                  <div class="small text-muted">Enhanced security for your account</div>
                </div>
                
                <div class="row align-items-center">
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Auto Logout</label>
                    <select class="form-select" formControlName="autoLogout">
                      <option value="15">15 minutes</option>
                      <option value="30">30 minutes</option>
                      <option value="60">1 hour</option>
                      <option value="120">2 hours</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Regional Settings -->
            <div class="settings-section mb-4">
              <h6 class="fw-semibold mb-3">Regional Settings</h6>
              <div class="bg-light p-3 rounded-3">
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Language</label>
                    <select class="form-select" formControlName="language">
                      <option value="en">English</option>
                      <option value="es">Spanish</option>
                      <option value="fr">French</option>
                      <option value="de">German</option>
                    </select>
                  </div>
                  
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Timezone</label>
                    <select class="form-select" formControlName="timezone">
                      <option value="UTC">UTC</option>
                      <option value="EST">Eastern Time</option>
                      <option value="CST">Central Time</option>
                      <option value="MST">Mountain Time</option>
                      <option value="PST">Pacific Time</option>
                    </select>
                  </div>
                  
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Currency</label>
                    <select class="form-select" formControlName="currency">
                      <option value="USD">USD ($)</option>
                      <option value="EUR">EUR (€)</option>
                      <option value="GBP">GBP (£)</option>
                      <option value="JPY">JPY (¥)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Save Settings -->
            <div class="d-flex justify-content-end">
              <button 
                class="btn btn-primary"
                (click)="saveSettings()"
                [disabled]="isSaving">
                <span *ngIf="!isSaving">
                  <i class="bi bi-check-circle me-2"></i>
                  Save Settings
                </span>
                <span *ngIf="isSaving">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Saving...
                </span>
              </button>
            </div>
          </form>
          
          <!-- Danger Zone -->
          <hr class="my-4">
          
          <div class="danger-zone">
            <h6 class="fw-semibold text-danger mb-3">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              Danger Zone
            </h6>
            <div class="bg-light p-3 rounded-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <span class="fw-semibold d-block">Deactivate Account</span>
                  <small class="text-muted">This action cannot be undone. Your account will be disabled.</small>
                </div>
                <button class="btn btn-outline-danger btn-sm" (click)="deactivateAccount()">
                  Deactivate
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>